<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fox Score</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="auth-ecran" class="input-group">
        <h3>ü¶ä Fox Score - Connexion</h3>
        <input type="email" id="auth-email" placeholder="Email">
        <input type="password" id="auth-password" placeholder="Mot de passe">
        <button id="auth-signup">Cr√©er un compte</button>
        <button id="auth-login">Se Connecter</button>
        <p id="auth-erreur" class="erreur-msg cache"></p>
    </div>

    <div id="app-layout" class="cache">

        <header id="main-header">
            <h1 id="main-title">Fox Score</h1>
        </header>

        <nav id="side-nav">
            <div id="nav-logo">
                <img src="FoxScore.png" alt="FoxScore" style="width: 100%; height: auto; max-width: 150px;">
            </div>
            <div id="nav-links">
                <a href="#" class="nav-link active" data-page="page-new-game">Nouvelle Partie</a>
                <a href="#" class="nav-link" data-page="page-ongoing-games">Parties en Cours</a>
                <a href="#" class="nav-link" data-page="page-history-grid">Historique</a>
                <a href="#" class="nav-link" data-page="page-friends">Mes Amis</a>
            </div>
            <div id="user-info-nav">
                <p>Connect√© : <strong id="user-email-nav"></strong></p>
                <button id="auth-logout">Se D√©connecter</button>
            </div>
        </nav>

        <main id="main-content">

            <div id="page-new-game" class="page-content cache">
                <h2>üé≤ Nouvelle Partie</h2>
                <div class="input-group">
                    <input type="text" id="nom-jeu-config" placeholder="Nom du jeu (ex: Skyjo...)" style="width: 300px;" list="datalist-jeux">
                    <datalist id="datalist-jeux"></datalist>
                </div>
                
                <div class="input-group add-player-group">
                    <div class="player-input-row">
                        <input type="text" id="nom-joueur" placeholder="Nom du joueur">
                        <span style="font-size: 0.9em; color: #777;">ou</span>
                        <select id="select-ami-ajout">
                            <option value="">-- Choisir un ami --</option>
                        </select>
                    </div>
                    <div class="player-color-row">
                        <label for="couleur-joueur" class="label-couleur">Couleur :</label>
                        <input type="color" id="couleur-joueur" value="#FF6384">
                        <button id="ajouter-joueur">Ajouter le joueur</button>
                    </div>
                </div>

                <div id="suggestions-joueurs" class="input-group cache">
                    <h3>Joueurs r√©cents :</h3>
                    <div id="liste-suggestions-joueurs" style="width: 100%;"></div>
                </div>
                <div id="liste-joueurs-conf" class="input-group"></div>

                <div class="input-group">
                    <h3 style="width: 100%; margin-bottom: 10px; color: #000;">Param√®tres de partie</h3>
                    <hr class="divider">
                    <div class="settings-options-wrapper">
                        <div class="setting-item inline">
                            <input type="checkbox" id="mode-secret-config">
                            <label for="mode-secret-config">Garder les scores secrets jusqu'√† la fin</label>
                        </div>
                        <div class="setting-item">
                            <label class="setting-title">Objectif du jeu :</label>
                            <div class="radio-option">
                                <input type="radio" id="score-least" name="condition-victoire" value="low" checked>
                                <label for="score-least">Avoir le MOINS de points</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="score-most" name="condition-victoire" value="high">
                                <label for="score-most">Avoir le PLUS de points</label>
                            </div>
                        </div>
                    </div> 
                    <button id="demarrer-partie" disabled>D√©marrer la partie</button>
                </div>
            </div>

            <div id="page-friends" class="page-content cache">
                <h2>Mes Amis</h2>
                <div class="input-group">
                    <h3>Ajouter un ami</h3>
                    <p style="width:100%; font-size: 0.9em; color: #666; margin-bottom: 10px;">Recherchez par email, puis choisissez un surnom et une couleur.</p>
                    
                    <div class="add-friend-form">
                        <input type="email" id="friend-email-input" placeholder="Email de l'ami (ex: ami@test.com)">
                        <div class="friend-details-inputs">
                            <input type="text" id="friend-nickname-input" placeholder="Surnom (Optionnel)">
                            <input type="color" id="friend-color-input" value="#36A2EB" title="Choisir une couleur">
                        </div>
                        <button id="btn-add-friend">Ajouter</button>
                    </div>
                    <p id="friend-add-msg" class="cache"></p>
                </div>

                <div class="input-group">
                    <h3>Liste d'amis</h3>
                    <div id="friends-list-container" style="width: 100%;">
                        <p>Chargement...</p>
                    </div>
                </div>
            </div>

            <div id="page-ongoing-games" class="page-content cache">
                <h2>Mes Parties en Cours</h2>
                <div id="liste-parties-sauvegardees"></div>
            </div>

            <div id="page-history-grid" class="page-content cache">
                <h2>Mon Historique</h2>
                <div class="stats-container">
                    <div id="stats-top-jeux" class="input-group">
                        <h3>üèÜ Top Jeux (Perf.)</h3>
                        <ol></ol>
                    </div>
                    <div id="stats-jeux-frequence" class="input-group">
                        <h3>üóìÔ∏è Jeux les Plus Jou√©s</h3>
                        <ol></ol>
                    </div>
                    <div id="stats-joueurs-podium" class="input-group">
                        <h3>üë• Top Joueurs</h3>
                        <ol></ol>
                    </div>
                </div>
                <p>Cliquez sur un jeu pour voir toutes les parties jou√©es.</p>
                <div id="history-grid-jeux"></div>
            </div>
            
            <div id="page-history-details" class="page-content cache">
                <button id="history-back-btn" class="bouton-simple">&larr; Retour √† l'historique</button>
                <h2 id="history-details-title">Historique pour...</h2>
                
                <div id="history-details-chart-controls" class="input-group">
                    <h3>Analyse de position</h3>
                    <div id="graph-players-list"></div>
                    <div class="add-graph-player-controls">
                        <select id="history-player-select"></select>
                        <button id="add-player-to-graph-btn" class="bouton-simple">+</button>
                    </div>
                    <div class="graphique-container-details">
                        <canvas id="graphique-position-details"></canvas>
                    </div>
                </div>

                <h3>Toutes les parties</h3>
                <div id="liste-historique-parties-details"></div>
            </div>

            <div id="page-score" class="page-content cache">
                <h2>üèÜ Scores en cours</h2>
                <div id="compteurs-manches">
                    <p>Manches jou√©es : <strong id="manches-passees">0</strong></p>
                    <p id="manches-restantes-affichage" class="cache">Manches restantes : <strong id="manches-restantes">--</strong></p>
                    <p id="points-restants-affichage" class="cache">Points avant limite : <strong id="points-restants">--</strong></p>
                </div>
                <div class="score-main-container">
                    <div class="score-gauche">
                        <div id="score-affichage"></div>
                        <div class="graphique-container input-group">
                            <h3>üìà √âvolution des Scores</h3>
                            <canvas id="graphique-scores"></canvas>
                        </div>
                        <div class="input-tour">
                            <h3>Nouveau Tour</h3>
                            <div id="saisie-points"></div>
                            <button id="valider-tour">Valider le Tour</button>
                            <button id="annuler-tour" class="bouton-simple" style="margin-top: 10px; border-color: #dc3545; color: #dc3545; width: 100%;">‚Ü©Ô∏è Corriger le dernier tour</button>
                        </div>
                    </div>
                    <div class="score-droite">
                        <h3>Conditions d'Arr√™t :</h3>
                        <div class="fin-partie-options input-group">
                            <label><input type="checkbox" class="condition-checkbox" id="check-score-limite" data-type="score_limite"> Arr√™ter quand un joueur atteint <input type="number" id="score-limite" min="1" value="100" disabled> points (Total).</label><br>
                            <label><input type="checkbox" class="condition-checkbox" id="check-score-relatif" data-type="score_relatif"> Arr√™ter quand un joueur a marqu√© <input type="number" id="score-relatif" min="1" value="50" disabled> points de plus que maintenant.</label><br>
                            <label><input type="checkbox" class="condition-checkbox" id="check-manche-total" data-type="manche_total"> Arr√™ter apr√®s un total de <input type="number" id="nb-manches-total" min="1" value="10" disabled> manches.</label><br>
                            <label><input type="checkbox" class="condition-checkbox" id="check-manche-restante" data-type="manche_restante"> Arr√™ter dans <input type="number" id="nb-manches-restantes" min="1" value="3" disabled> manches restantes.</label>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <button id="sauvegarder-partie" style="background-color: #28a745; width: 100%;">Sauvegarder Manuellement</button>
                            <p id="save-feedback" style="color: green; text-align: center; height: 20px; font-size: 0.9em; margin: 0;"></p>
                        </div>

                        <button id="arreter-maintenant" class="bouton-fin">Terminer la partie Maintenant</button>
                    </div>
                </div>
            </div>

            <div id="page-podium" class="page-content cache">
                <h2>üéâ Podium Final !</h2>
                <div id="podium-visuel">
                    <div class="podium-place" id="podium-2"><span class="podium-medaille">ü•à</span><div class="podium-nom">...</div><div class="podium-score">...</div></div>
                    <div class="podium-place" id="podium-1"><span class="podium-medaille">ü•á</span><div class="podium-nom">...</div><div class="podium-score">...</div></div>
                    <div class="podium-place" id="podium-3"><span class="podium-medaille">ü•â</span><div class="podium-nom">...</div><div class="podium-score">...</div></div>
                </div>
                <div id="autres-joueurs" class="input-group">
                    <h3>Autres Joueurs</h3>
                    <ul id="autres-joueurs-liste"></ul>
                </div>
                <div id="graphique-final-container" class="input-group"></div>
                <button id="retour-accueil-btn" class="bouton-fin" style="background-color: #6c757d; margin-top: 20px;">Retour √† l'accueil</button>
            </div>

        </main> 
    </div> 
    
    <div id="reveal-ecran" class="cache">
        <div id="reveal-content">
            <h3 id="reveal-rang">5√®me Place</h3>
            <div class="reveal-nom-container">
                <h2 id="reveal-nom-placeholder">???</h2>
                <h2 id="reveal-nom">Nom du Joueur</h2>
            </div>
            <p id="reveal-score">0 points</p>
        </div>
        <button id="skip-all-btn" class="bouton-fin">Passer l'animation</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-auth-compat.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyD1cC-bahvm3fqZcsYYiBvolyaqVyMGXnI",
        authDomain: "compteur-point-julien.firebaseapp.com",
        projectId: "compteur-point-julien",
        storageBucket: "compteur-point-julien.appspot.com",
        messagingSenderId: "961827366523",
        appId: "1:961827366523:web:51db1d7ac1f975f569e4de"
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
    </script>
    <script src="script.js"></script>

</body>
</html>
